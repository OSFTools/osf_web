<!DOCTYPE html>

<a href="index.html">Return to index page</a>

<html>
    <head>
        <title>Verification of C3S seasonal forecasts for MENA</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <!-- need a new css <link rel="stylesheet" href="css/site.css"/> -->
        <!-- jquery scripts must be in the <head> -->
        <!-- code for the drop-down browser-->
        <!-- the jQuery library location (using consistent version with other scripts)-->
        <script src="js/jquery-2.1.1.min.js"></script>
        <script>
            //use jquery to change the imgElem element in the html
            // when one of the dropdowns is selected
            //
            // domain (possibly make selectable in future)
            const domain = "_45:-30:-2.5:60_";

            // list of metrics that require a category dropdown
            const catList = ['roc', 'rocss', 'bs'];

            function getImageSrc(){

                let seasname;
                // specify the path to the folder containing the imgs 
                var imgFolder = "c3s_eval_plots_hc/"; 

                // loop through each select element
                $("select").each(function(){
                    // fire function to set src on start
                    setImageSrc();
                    hideCat();
                    hideSeas();

                    // fire function to get src on change
                    $(this).change(function(){
                        setImageSrc();
                        hideCat();
                        hideSeas();
                    })
                });
    

                function hideCat(){
                    $(this).change(function(){
                        if (catList.includes($("#m-det").val())){
                            $("#cat").show();
                        }
                        else{
                            $("#cat").hide();
                        }
                    })
                }

                function setImageSrc(){
                    // update image for  plots based on chosen
                    // dropbox boxes
                    var imageSrc;

                    if ($("#period").val() == "3m"){

                        // 3 month lead time (will need further improvements to deal with varying FC range)
                        // may be best to change filename patterns?
                        const month_seas_3m = new Map([
                            ["FMA", "1_234"],
                            ["MAM", "2_234"],
                            ["AMJ", "3_234"],
                            ["MJJ", "4_234"],
                            ["JJA", "5_234"],
                            ["JAS", "6_234"],
                            ["ASO", "7_234"],
                            ["SON", "8_234"],
                            ["OND", "9_234"],
                            ["NDJ", "10_234"],
                            ["DJF", "11_234"],
                            ["JFM", "12_234"]
                        ]);

                        seasname = month_seas_3m.get($("#seas").val());

                    }
                    else
                    {
                        // 1 month lead time. Filenames need to change. Not 234....
                        // also do we already do multiple fc ranges?
                        const month_seas_1m = new Map([
                            ["Feb", "1_234"],
                            ["Mar", "2_234"],
                            ["Apr", "3_234"],
                            ["May", "4_234"],
                            ["Jun", "5_234"],
                            ["Jul", "6_234"],
                            ["Aug", "7_234"],
                            ["Sep", "8_234"],
                            ["Oct", "9_234"],
                            ["Nov", "10_234"],
                            ["Dec", "11_234"],
                            ["Jan", "12_234"]
                        ]);
                        seasname = month_seas_1m.get($("#mon").val());
                    }
                    // create an img element with the src each 
                    // time and append to the image wrap div


                    // depends on whether this is probabilistic or not
                    // pattern for probabilistic:
                    // 

                    
                    if (catList.includes($("#m-det").val())){
                        imageSrc = imgFolder + $("#model").val() + 
                            "_1993-2016_monthly_mean_" +
                            seasname + 
                            domain +
                            $("#var").val()  + "." +
                            $("#period").val()  + "." +
                            $("#m-det").val() + "_" + 
                            $("#cat").val()  +
                            ".png" ;
                    }
                    else{
                        imageSrc = imgFolder + $("#model").val() + 
                            "_1993-2016_monthly_mean_" +
                            seasname + 
                            domain +
                            $("#var").val()  + "." +
                            $("#period").val()  + "." +
                            $("#m-det").val() + 
                            ".png" ;
                    }
                    // do update
                    $("#img-det").html(`<img src="${imageSrc}" width=800>`);

                };
                // hide the season dropdown for monthly forecasts and monthly for 3 month forecasts
                function hideSeas(){
                    $(this).change(function(){
                        if ($("#period").val() == "3m"){
                            $("#seas").show();
                            $("#mon").hide();
                        }
                        else{
                            $("#seas").hide();
                            $("#mon").show();
                        }
                    })
                }
                
            }
            // fire functions on page-load
            // as spearman is default hide category selector
            // as 3 month is default, hide month selector
            $(document).ready(function(){
                $("#cat").hide();
                $("#mon").hide();
                getImageSrc();
            })
        </script>
    </head>

    <!--Start of body -->
    <body >

            
    <h1>C3S Models evaluation</h1>

            <div id="main">
                <!--controls-->
                <!--value must match filename patterns for static images-->
                <select id="period">
                    <option value="3m" selected>3m mean</option>
                    <option value="1m">1m mean</option> 
                </select>
                <select id="model">
                    <option value="cmcc_35">cmcc_35</option>
                    <option value="dwd_22">dwd_22</option>
                    <option value="eccc_4">eccc_4</option>
                    <option value="eccc_5">eccc_5</option>
                    <option value="ecmwf_51">ecmwf_51</option>
                    <option value="meteo_france_9">meteo_france_9</option>
                    <option value="ncep_2">ncep_2</option>
                    <option value="ukmo_604">ukmo_604</option>
                </select>
                <select id="m-det">
                    <option value="spearman_corr" selected>Spearman Correlation</option>
                    <option value="pearson_corr">ACC</option>
                    <option value="rel">Reliability diagram</option>
                    <option value="rps">RPS</option>
                    <option value="bs">Briar Score</option>
                    <option value="roc">ROC</option>
                    <option value="rocss">ROC Skill score</option>
                </select>
                <select id="seas">
                    <!-- to deal with variable forecast ranges this needs some logic -->
                    <option value="FMA">FMA</option>
                    <option value="MAM">MAM</option>
                    <option value="AMJ">AMJ</option>
                    <option value="MJJ">MJJ</option>
                    <option value="JJA">JJA</option>
                    <option value="JAS">JAS</option>
                    <option value="ASO">ASO</option>
                    <option value="SON">SON</option>
                    <option value="OND">OND</option>
                    <option value="NDJ">NDJ</option>
                    <option value="DJF">DJF</option>
                    <option value="JFM">JFM</option>
                </select>
                <select id="mon">
                    <option value="Feb">Feb</option>
                    <option value="Mar">Mar</option>
                    <option value="Apr">Apr</option>
                    <option value="May">May</option>
                    <option value="Jun">Jun</option>
                    <option value="Jul">Jul</option>
                    <option value="Aug">Aug</option>
                    <option value="Sep">Sep</option>
                    <option value="Oct">Oct</option>
                    <option value="Nov">Nov</option>
                    <option value="Dec">Dec</option>
                    <option value="Jan">Jan</option>
                </select>
                <select id="var">
                    <option value="2m_temperature">T2m</option>
                    <option value="total_precipitation">Rain rate</option>
                </select>
                <select id="cat">
                    <option value="category_0">Lower</option>
                    <option value="category_1">Middle</option>
                    <option value="category_2">Upper</option>
                </select>
         
                <!--Image Displays here-->
                <div id="img-det"></div>
        

            </div>      
            <div id="footer">
                Crown Copyright &copy; <script>document.write( new Date().getFullYear() );</script>, the Met Office. All Rights Reserved.
            </div>
    </body>
</html>

